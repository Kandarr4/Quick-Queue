

<div class="container fade-in" data-database-name="demo_base">
    <div class="page-header">
        <h1 class="page-title"><i class="fas fa-cogs mr-2"></i>Панель администратора</h1>
        <div class="header-actions">
            <a href="javascript:void(0);" class="btn btn-info" onclick="alert('Переход на страницу статистики (демо-версия).')">
                <i class="fas fa-chart-bar"></i> Статистика
            </a>
            <button type="button" class="btn btn-danger" onclick="alert('Выход из системы (демо-версия).')">
                <i class="fas fa-sign-out-alt"></i> Выход
            </button>
        </div>
    </div>

    <ul class="nav nav-pills mb-4" id="adminTab" role="tablist">
        <li class="nav-item">
            <a class="nav-link active" id="users-tab" data-toggle="pill" href="#users" role="tab"><i class="fas fa-users"></i> Пользователи</a>
        </li>
        <li class="nav-item">
            <a class="nav-link" id="services-tab" data-toggle="pill" href="#services" role="tab"><i class="fas fa-concierge-bell"></i> Услуги</a>
        </li>
        <li class="nav-item">
            <a class="nav-link" id="videos-tab" data-toggle="pill" href="#videos" role="tab"><i class="fas fa-film"></i> Видео</a>
        </li>
    </ul>

    <div class="tab-content" id="adminTabContent">
        
        <div class="tab-pane fade show active" id="users" role="tabpanel">
            <div class="d-flex justify-content-between mb-4">
                <div>
                    <button type="button" class="btn btn-primary mr-2" data-toggle="modal" data-target="#addUserModal"><i class="fas fa-user-plus"></i> Добавить</button>
                    <button type="button" class="btn btn-success" id="groupUsersBtn"><i class="fas fa-object-group"></i> Объединить</button>
                </div>
                <div class="form-group mb-0"><input type="text" class="form-control" id="userSearchInput" placeholder="Поиск пользователей..."></div>
            </div>
            <div class="table-wrapper">
                <div class="table-responsive">
                    <table class="table">
                        <thead>
                            <tr><th width="40"></th><th width="60">ID</th><th>Имя</th><th>Роль</th><th>Кабинет</th><th>Действия</th></tr>
                        </thead>
                        <tbody>
                            
                            <tr class="group-row">
                                <td colspan="6" class="p-0">
                                    <div class="group-header">
                                        <button class="group-toggle toggle-group" data-group-id="0"><i class="fas fa-minus"></i></button>
                                        <h5 class="group-name">Терапевты</h5>
                                        <div class="group-actions"><button class="btn btn-danger btn-sm delete-group-btn"><i class="fas fa-trash-alt"></i></button></div>
                                    </div>
                                </td>
                            </tr>
                            <tr class="group-users group-0">
                                <td colspan="6">
                                    <div class="highlighted-group">
                                        <table class="table mb-0">
                                            <tbody>
                                                <tr class="user-row">
                                                    <td>10</td>
                                                    <td>doctor_ivanov</td>
                                                    <td><span class="badge badge-pill badge-info">operator</span></td>
                                                    <td><span class="badge badge-pill badge-secondary"><i class="fas fa-door-open mr-1"></i> 101</span></td>
                                                    <td>
                                                        <div class="btn-group">
                                                            <button class="btn btn-primary btn-sm show-dependencies-btn" data-user-id="10" title="Услуги"><i class="fas fa-tasks"></i></button>
                                                            <button class="btn btn-secondary btn-sm edit-user-btn" data-toggle="modal" data-target="#editUserModal" data-id="10" data-username="doctor_ivanov" data-role="operator" data-cabinet="101"><i class="fas fa-edit"></i></button>
                                                            <button class="btn btn-danger btn-sm delete-user-btn"><i class="fas fa-trash-alt"></i></button>
                                                        </div>
                                                    </td>
                                                </tr>
                                                <tr class="user-row">
                                                    <td>12</td>
                                                    <td>doctor_petrova</td>
                                                    <td><span class="badge badge-pill badge-info">operator</span></td>
                                                    <td><span class="badge badge-pill badge-secondary"><i class="fas fa-door-open mr-1"></i> 102</span></td>
                                                    <td>
                                                         <div class="btn-group">
                                                            <button class="btn btn-primary btn-sm show-dependencies-btn" data-user-id="12" title="Услуги"><i class="fas fa-tasks"></i></button>
                                                            <button class="btn btn-secondary btn-sm edit-user-btn" data-toggle="modal" data-target="#editUserModal" data-id="12" data-username="doctor_petrova" data-role="operator" data-cabinet="102"><i class="fas fa-edit"></i></button>
                                                            <button class="btn btn-danger btn-sm delete-user-btn"><i class="fas fa-trash-alt"></i></button>
                                                        </div>
                                                    </td>
                                                </tr>
                                            </tbody>
                                        </table>
                                    </div>
                                </td>
                            </tr>
                            
                            <tr class="user-row">
                                <td><div class="form-check"><input type="checkbox" class="form-check-input user-checkbox" data-user-id="15" id="user-15"><label class="form-check-label" for="user-15"></label></div></td>
                                <td>15</td>
                                <td>registratura</td>
                                <td><span class="badge badge-pill badge-info">terminal</span></td>
                                <td></td>
                                <td>
                                    <div class="btn-group">
                                        <button class="btn btn-primary btn-sm show-dependencies-btn" data-user-id="15" title="Услуги"><i class="fas fa-tasks"></i></button>
                                        <button class="btn btn-secondary btn-sm edit-user-btn" data-toggle="modal" data-target="#editUserModal" data-id="15" data-username="registratura" data-role="terminal" data-cabinet=""><i class="fas fa-edit"></i></button>
                                        <button class="btn btn-danger btn-sm delete-user-btn"><i class="fas fa-trash-alt"></i></button>
                                    </div>
                                </td>
                            </tr>
                            <tr class="user-row">
                                <td><div class="form-check"><input type="checkbox" class="form-check-input user-checkbox" data-user-id="18" id="user-18"><label class="form-check-label" for="user-18"></label></div></td>
                                <td>18</td>
                                <td>main_tablo</td>
                                <td><span class="badge badge-pill badge-info">tablo</span></td>
                                <td></td>
                                <td>
                                    <div class="btn-group">
                                        <button class="btn btn-primary btn-sm show-dependencies-btn" data-user-id="18" title="Услуги"><i class="fas fa-tasks"></i></button>
                                        <button class="btn btn-secondary btn-sm edit-user-btn" data-toggle="modal" data-target="#editUserModal" data-id="18" data-username="main_tablo" data-role="tablo" data-cabinet="" data-video="true" data-video-folder="promo"><i class="fas fa-edit"></i></button>
                                        <button class="btn btn-danger btn-sm delete-user-btn"><i class="fas fa-trash-alt"></i></button>
                                    </div>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        
        <div class="tab-pane fade" id="services" role="tabpanel">
            <div class="d-flex justify-content-between mb-4">
                <button type="button" class="btn btn-primary" data-toggle="modal" data-target="#addServiceModal"><i class="fas fa-plus-circle"></i> Добавить услугу</button>
                <div class="form-group mb-0"><input type="text" class="form-control" id="serviceSearchInput" placeholder="Поиск услуг..."></div>
            </div>
            <div class="table-wrapper">
                <div class="table-responsive">
                    <table class="table">
                        <thead><tr><th>Название</th><th>Нач. номер</th><th>Кон. номер</th><th>Кабинет</th><th>Действия</th></tr></thead>
                        <tbody id="servicesList">
                            <tr class="service-row">
                                <td><strong>Прием терапевта</strong></td><td>100</td><td>199</td>
                                <td><span class="badge badge-pill badge-secondary"><i class="fas fa-door-open mr-1"></i> 101</span></td>
                                <td>
                                    <div class="btn-group">
                                        <button class="btn btn-secondary btn-sm edit-service-btn" data-toggle="modal" data-target="#editServiceModal" data-service-id="1" data-service-name="Прием терапевта" data-start-number="100" data-end-number="199" data-cabinet="101"><i class="fas fa-edit"></i></button>
                                        <button class="btn btn-info btn-sm schedule-service-btn" data-service-id="1" data-service-name="Прием терапевта"><i class="fas fa-calendar-alt"></i></button>
                                        <button class="btn btn-danger btn-sm delete-service-btn"><i class="fas fa-trash-alt"></i></button>
                                        <button class="btn btn-warning btn-sm delete-all-tickets-btn"><i class="fas fa-ticket-alt"></i> <i class="fas fa-ban"></i></button>
                                    </div>
                                </td>
                            </tr>
                            <tr class="service-row">
                                <td><strong>Сдача анализов</strong></td><td>200</td><td>299</td>
                                <td><span class="badge badge-pill badge-secondary"><i class="fas fa-door-open mr-1"></i> 205</span></td>
                                <td>
                                    <div class="btn-group">
                                        <button class="btn btn-secondary btn-sm edit-service-btn" data-toggle="modal" data-target="#editServiceModal" data-service-id="2" data-service-name="Сдача анализов" data-start-number="200" data-end-number="299" data-cabinet="205"><i class="fas fa-edit"></i></button>
                                        <button class="btn btn-info btn-sm schedule-service-btn" data-service-id="2" data-service-name="Сдача анализов"><i class="fas fa-calendar-alt"></i></button>
                                        <button class="btn btn-danger btn-sm delete-service-btn"><i class="fas fa-trash-alt"></i></button>
                                        <button class="btn btn-warning btn-sm delete-all-tickets-btn"><i class="fas fa-ticket-alt"></i> <i class="fas fa-ban"></i></button>
                                    </div>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        
        <div class="tab-pane fade" id="videos" role="tabpanel">
            <div class="mb-4 d-flex justify-content-between align-items-center">
                <div>
                    <button type="button" class="btn btn-primary mr-2" data-toggle="modal" data-target="#createFolderModal"><i class="fas fa-folder-plus"></i> Создать папку</button>
                    <button type="button" class="btn btn-success mr-2" data-toggle="modal" data-target="#uploadVideoModal"><i class="fas fa-upload"></i> Загрузить видео</button>
                </div>
                <div class="input-group" style="max-width: 300px;"><input type="text" class="form-control" id="videoSearchInput" placeholder="Поиск..."><div class="input-group-append"><span class="input-group-text"><i class="fas fa-search"></i></span></div></div>
            </div>
            <div id="disk-space-info" class="mb-3 p-3 rounded" style="background-color: rgba(255,255,255,0.05);">
                <div class="d-flex justify-content-between align-items-center">
                    <div>
                        <i class="fas fa-hdd mr-2"></i><strong>Диск:</strong> <span class="text-white">15.8 ГБ</span> / <span class="text-muted">29.5 ГБ</span>
                    </div>
                    <div class="progress" style="width: 50%; height: 20px;">
                        <div class="progress-bar bg-success" role="progressbar" style="width: 53%;" aria-valuenow="53" aria-valuemin="0" aria-valuemax="100">53%</div>
                    </div>
                    <button id="refreshDiskSpaceBtn" class="btn btn-sm btn-outline-secondary"><i class="fas fa-sync-alt"></i></button>
                </div>
            </div>
            <nav aria-label="breadcrumb" class="mb-3">
                <ol class="breadcrumb" id="breadcrumb-container" style="background-color: rgba(255,255,255,0.1);"></ol>
            </nav>
            <div class="video-container-wrapper mb-4">
                <h5 class="mb-3"><i class="fas fa-folder mr-2"></i>Папки</h5>
                <div class="row" id="folders-container"></div>
                <h5 class="mb-3 mt-4"><i class="fas fa-film mr-2"></i>Видеофайлы</h5>
                <div class="row" id="videos-container"></div>
            </div>
        </div>
    </div>
</div>

	
	<div class="modal fade" id="createFolderModal" tabindex="-1" role="dialog" aria-labelledby="createFolderModalLabel" aria-hidden="true">
		<div class="modal-dialog" role="document">
			<div class="modal-content">
				<div class="modal-header">
					<h5 class="modal-title" id="createFolderModalLabel"><i class="fas fa-folder-plus mr-2"></i>Создать новую папку</h5>
					<button type="button" class="close" data-dismiss="modal" aria-label="Close">
						<span aria-hidden="true">&times;</span>
					</button>
				</div>
				<div class="modal-body">
					<form id="createFolderForm">
						<div class="form-group">
							<label for="folderName">Название папки</label>
							<input type="text" class="form-control" id="folderName" placeholder="Введите название папки" required>
							<small class="form-text text-muted">Папка будет создана в текущей директории: <span id="current-dir-for-new-folder">/</span></small>
						</div>
						<div class="modal-footer">
							<button type="button" class="btn btn-secondary" data-dismiss="modal">
								<i class="fas fa-times mr-1"></i> Отмена
							</button>
							<button type="submit" class="btn btn-primary">
								<i class="fas fa-folder-plus mr-1"></i> Создать папку
							</button>
						</div>
					</form>
				</div>
			</div>
		</div>
	</div>

	
	<div class="modal fade" id="uploadVideoModal" tabindex="-1" role="dialog" aria-labelledby="uploadVideoModalLabel" aria-hidden="true">
		<div class="modal-dialog modal-lg" role="document"> 
			<div class="modal-content">
				<div class="modal-header">
					<h5 class="modal-title" id="uploadVideoModalLabel"><i class="fas fa-upload mr-2"></i>Загрузить видео</h5>
					<button type="button" class="close" data-dismiss="modal" aria-label="Close">
						<span aria-hidden="true">×</span>
					</button>
				</div>
				<div class="modal-body">
					<form id="uploadVideoForm" enctype="multipart/form-data">
						<div class="form-group">
							<label for="videoFile">Выберите видеофайлы</label>
							<div class="custom-file">
								
								<input type="file" class="custom-file-input" id="videoFile" name="video" accept="video/*" required multiple>
								<label class="custom-file-label" for="videoFile">Выберите файлы...</label>
							</div>
							<small class="form-text text-muted">Поддерживаемые форматы: MP4, WebM, MOV, AVI, MKV. Можно выбрать несколько файлов.</small>
							<small class="form-text text-muted">Видео будет загружено в директорию: <span id="current-dir-for-upload">/</span></small>
						</div>
						
						
						<div id="uploadProgressContainer" class="mt-3" style="display: none;">
							<h6 class="mb-2">Прогресс загрузки:</h6>
							<div id="upload-progress-list">
								
							</div>
						</div>
						
						<div class="modal-footer">
							<button type="button" class="btn btn-secondary" data-dismiss="modal" id="uploadCancelBtn">
								<i class="fas fa-times mr-1"></i> Отмена
							</button>
							<button type="submit" class="btn btn-primary" id="uploadSubmitBtn">
								<i class="fas fa-upload mr-1"></i> Загрузить
							</button>
						</div>
					</form>
				</div>
			</div>
		</div>
	</div>

	
	<div class="modal fade" id="renameModal" tabindex="-1" role="dialog" aria-labelledby="renameModalLabel" aria-hidden="true">
		<div class="modal-dialog" role="document">
			<div class="modal-content">
				<div class="modal-header">
					<h5 class="modal-title" id="renameModalLabel"><i class="fas fa-edit mr-2"></i>Переименовать</h5>
					<button type="button" class="close" data-dismiss="modal" aria-label="Close">
						<span aria-hidden="true">&times;</span>
					</button>
				</div>
				<div class="modal-body">
					<form id="renameForm">
						<input type="hidden" id="renameItemType" value="">
						<input type="hidden" id="renameItemPath" value="">
						<div class="form-group">
							<label for="newName">Новое название</label>
							<input type="text" class="form-control" id="newName" required>
						</div>
						<div class="modal-footer">
							<button type="button" class="btn btn-secondary" data-dismiss="modal">
								<i class="fas fa-times mr-1"></i> Отмена
							</button>
							<button type="submit" class="btn btn-primary">
								<i class="fas fa-check mr-1"></i> Переименовать
							</button>
						</div>
					</form>
				</div>
			</div>
		</div>
	</div>

	
	<div class="modal fade" id="moveModal" tabindex="-1" role="dialog" aria-labelledby="moveModalLabel" aria-hidden="true">
		<div class="modal-dialog" role="document">
			<div class="modal-content">
				<div class="modal-header">
					<h5 class="modal-title" id="moveModalLabel"><i class="fas fa-exchange-alt mr-2"></i>Переместить</h5>
					<button type="button" class="close" data-dismiss="modal" aria-label="Close">
						<span aria-hidden="true">&times;</span>
					</button>
				</div>
				<div class="modal-body">
					<form id="moveForm">
						<input type="hidden" id="moveItemType" value="">
						<input type="hidden" id="moveItemPath" value="">
						<div class="form-group">
							<label for="targetFolder">Выберите целевую папку</label>
							<select class="form-control" id="targetFolder" required>
								<option value="/">/</option>
								
							</select>
						</div>
						<div class="modal-footer">
							<button type="button" class="btn btn-secondary" data-dismiss="modal">
								<i class="fas fa-times mr-1"></i> Отмена
							</button>
							<button type="submit" class="btn btn-primary">
								<i class="fas fa-exchange-alt mr-1"></i> Переместить
							</button>
						</div>
					</form>
				</div>
			</div>
		</div>
	</div>

	
	<div class="modal fade" id="previewVideoModal" tabindex="-1" role="dialog" aria-labelledby="previewVideoModalLabel" aria-hidden="true">
		<div class="modal-dialog modal-lg" role="document">
			<div class="modal-content">
				<div class="modal-header">
					<h5 class="modal-title" id="previewVideoModalLabel"><i class="fas fa-film mr-2"></i>Просмотр видео</h5>
					<button type="button" class="close" data-dismiss="modal" aria-label="Close">
						<span aria-hidden="true">&times;</span>
					</button>
				</div>
				<div class="modal-body text-center">
					<div class="embed-responsive embed-responsive-16by9">
						<video class="embed-responsive-item" id="previewVideoPlayer" controls>
							<source src="" type="video/mp4">
							Ваш браузер не поддерживает видео.
						</video>
					</div>
				</div>
				<div class="modal-footer">
					<button type="button" class="btn btn-secondary" data-dismiss="modal">
						<i class="fas fa-times mr-1"></i> Закрыть
					</button>
				</div>
			</div>
		</div>
	</div>

	
	<div class="modal fade" id="confirmDeleteModal" tabindex="-1" role="dialog" aria-labelledby="confirmDeleteModalLabel" aria-hidden="true">
		<div class="modal-dialog" role="document">
			<div class="modal-content">
				<div class="modal-header bg-danger text-white">
					<h5 class="modal-title" id="confirmDeleteModalLabel"><i class="fas fa-exclamation-triangle mr-2"></i>Подтверждение удаления</h5>
					<button type="button" class="close text-white" data-dismiss="modal" aria-label="Close">
						<span aria-hidden="true">&times;</span>
					</button>
				</div>
				<div class="modal-body">
					<p id="confirmDeleteText">Вы уверены, что хотите удалить этот элемент?</p>
					<div class="alert alert-warning">
						<i class="fas fa-info-circle mr-1"></i> Это действие необратимо!
					</div>
					<input type="hidden" id="deleteItemType" value="">
					<input type="hidden" id="deleteItemPath" value="">
				</div>
				<div class="modal-footer">
					<button type="button" class="btn btn-secondary" data-dismiss="modal">
						<i class="fas fa-times mr-1"></i> Отмена
					</button>
					<button type="button" class="btn btn-danger" id="confirmDeleteBtn">
						<i class="fas fa-trash-alt mr-1"></i> Удалить
					</button>
				</div>
			</div>
		</div>
	</div>

	
	<template id="folder-card-template">
		<div class="col-md-4 col-lg-3 mb-4 folder-card">
			<div class="card bg-dark text-light folder-item">
				<div class="card-body p-3">
					<div class="d-flex justify-content-between align-items-center mb-2">
						<div class="folder-icon">
							<i class="fas fa-folder fa-2x text-warning"></i>
						</div>
						<div class="dropdown">
							<button class="btn btn-sm btn-dark dropdown-toggle" type="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
								<i class="fas fa-ellipsis-v"></i>
							</button>
							<div class="dropdown-menu dropdown-menu-right">
								<a class="dropdown-item rename-folder" href="#"><i class="fas fa-edit mr-2"></i>Переименовать</a>
								<a class="dropdown-item move-folder" href="#"><i class="fas fa-exchange-alt mr-2"></i>Переместить</a>
								<div class="dropdown-divider"></div>
								<a class="dropdown-item delete-folder text-danger" href="#"><i class="fas fa-trash-alt mr-2"></i>Удалить</a>
							</div>
						</div>
					</div>
					<h6 class="card-title folder-name-text text-truncate mb-0"></h6>
					<p class="card-text folder-info small text-muted mt-2"></p>
				</div>
				<div class="card-footer p-2 text-center">
					<button class="btn btn-primary btn-sm open-folder">
						<i class="fas fa-folder-open mr-1"></i> Открыть
					</button>
				</div>
			</div>
		</div>
	</template>

	<template id="video-card-template">
		<div class="col-md-4 col-lg-3 mb-4 video-card">
			<div class="card bg-dark text-light video-item">
				<div class="video-thumbnail position-relative" style="height: 140px; background-color: #1a2530; overflow: hidden;">
					<div class="play-icon position-absolute" style="top: 50%; left: 50%; transform: translate(-50%, -50%);">
						<i class="fas fa-play-circle fa-3x text-light opacity-75"></i>
					</div>
					<div class="video-duration position-absolute badge badge-dark" style="bottom: 10px; right: 10px;">
						00:00
					</div>
				</div>
				<div class="card-body p-3">
					<div class="d-flex justify-content-between align-items-center mb-2">
						<div class="video-icon">
							<i class="fas fa-film text-info"></i>
						</div>
						<div class="dropdown">
							<button class="btn btn-sm btn-dark dropdown-toggle" type="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
								<i class="fas fa-ellipsis-v"></i>
							</button>
							<div class="dropdown-menu dropdown-menu-right">
								<a class="dropdown-item preview-video" href="#"><i class="fas fa-eye mr-2"></i>Просмотр</a>
								<a class="dropdown-item rename-video" href="#"><i class="fas fa-edit mr-2"></i>Переименовать</a>
								<a class="dropdown-item move-video" href="#"><i class="fas fa-exchange-alt mr-2"></i>Переместить</a>
								<div class="dropdown-divider"></div>
								<a class="dropdown-item delete-video text-danger" href="#"><i class="fas fa-trash-alt mr-2"></i>Удалить</a>
							</div>
						</div>
					</div>
					<h6 class="card-title video-name-text text-truncate"></h6>
					<p class="card-text video-info small text-muted"></p>
				</div>
				<div class="card-footer p-2 text-center">
					<button class="btn btn-info btn-sm preview-video-btn">
						<i class="fas fa-play mr-1"></i> Воспроизвести
					</button>
				</div>
			</div>
		</div>
	</template>

    
    <div class="modal fade" id="groupModal" tabindex="-1" role="dialog" aria-labelledby="groupModalLabel" aria-hidden="true">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="groupModalLabel"><i class="fas fa-object-group mr-2"></i>Создать группу</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body">
                    <form id="groupForm">
                        <div class="form-group">
                            <label for="groupName">Название группы</label>
                            <input type="text" class="form-control" id="groupName" required>
                        </div>
                        <div class="modal-footer">
                            <button type="button" class="btn btn-secondary" data-dismiss="modal">
                                <i class="fas fa-times mr-1"></i> Отмена
                            </button>
                            <button type="submit" class="btn btn-primary">
                                <i class="fas fa-save mr-1"></i> Создать группу
                            </button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>


    <div class="modal fade" id="addUserModal" tabindex="-1" role="dialog" aria-labelledby="addUserModalLabel" aria-hidden="true">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="addUserModalLabel"><i class="fas fa-user-plus mr-2"></i>Добавить пользователя</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body">
                    <form action="{{ url_for('secondary_admin.add_user') }}" method="post">
                        <input type="hidden" name="csrf_token" value="{{ user_form.csrf_token._value() }}">
                        <div class="form-group">
                            <label for="{{ user_form.username.id }}">
                                <i class="fas fa-user mr-1"></i> {{ user_form.username.label.text }}
                            </label>
                            {{ user_form.username(class_='form-control', placeholder='Введите имя пользователя') }}
                        </div>
                        <div class="form-group">
                            <label for="{{ user_form.password.id }}">
                                <i class="fas fa-lock mr-1"></i> {{ user_form.password.label.text }}
                            </label>
                            {{ user_form.password(class_='form-control', placeholder='Введите пароль') }}
                        </div>
                        <div class="form-group">
                            <label for="{{ user_form.role.id }}">
                                <i class="fas fa-user-tag mr-1"></i> {{ user_form.role.label.text }}
                            </label>
                            {{ user_form.role(class_='form-control') }}
                        </div>
                        <div class="form-group">
                            <label for="{{ user_form.cabinet.id }}">
                                <i class="fas fa-door-open mr-1"></i> {{ user_form.cabinet.label.text }}
                            </label>
                            {{ user_form.cabinet(class_='form-control', placeholder='Введите номер кабинета') }}
                        </div>
                        <div class="modal-footer">
                            <button type="button" class="btn btn-secondary" data-dismiss="modal">
                                <i class="fas fa-times mr-1"></i> Закрыть
                            </button>
                            <button type="submit" class="btn btn-primary">
                                <i class="fas fa-save mr-1"></i> Добавить пользователя
                            </button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>

	<div class="modal fade" id="editUserModal" tabindex="-1" role="dialog" aria-labelledby="editUserModalLabel" aria-hidden="true">
		<div class="modal-dialog" role="document">
			<div class="modal-content">
				<div class="modal-header">
					<h5 class="modal-title" id="editUserModalLabel"><i class="fas fa-user-edit mr-2"></i>Редактировать пользователя</h5>
					<button type="button" class="close" data-dismiss="modal" aria-label="Close">
						<span aria-hidden="true">×</span>
					</button>
				</div>
				<div class="modal-body">
					<form id="editUserForm">
						<input type="hidden" id="editUserId" name="user_id">
						<div class="form-group">
							<label for="editUsername">
								<i class="fas fa-user mr-1"></i> Имя пользователя
							</label>
							<input type="text" class="form-control" id="editUsername" name="username" required>
						</div>
                        <div class="form-group">
                            <label for="editRole"> 
                                <i class="fas fa-user-tag mr-1"></i> Роль
                            </label>
                            
                            {{ user_form.role(class_='form-control', id='editRole') }}
                        </div>

						<div class="form-group">
							<label for="editCabinet">
								<i class="fas fa-door-open mr-1"></i> Номер кабинета
							</label>
							<input type="text" class="form-control" id="editCabinet" name="cabinet">
						</div>
						
						<div id="videoSettingsContainer" class="form-group" style="display: none;">
							<hr>
							<h6><i class="fas fa-video mr-1"></i> Настройки видео</h6>
							<div class="form-check mb-2">
								
								<input type="checkbox" class="form-check-input" id="editShowVideo" name="show_video">
								<label class="form-check-label" for="editShowVideo">Показывать видео</o>
							</div>
							<div id="videoFolderContainer" class="form-group" style="display: none;">
								<label for="editVideoFolder">
									<i class="fas fa-folder-open mr-1"></i> Папка с видео
								</label>
								<select class="form-control" id="editVideoFolder" name="video_folder">
                                    
								</select>
								<small class="form-text text-muted">
									Выберите папку в директории <strong>static/video/{{current_user.database_name}}/</strong>
								</small>
								<div class="mt-2">
									<button type="button" class="btn btn-sm btn-secondary refresh-folders-btn">
										<i class="fas fa-sync-alt mr-1"></i> Обновить список папок
									</button>
								</div>
							</div>
						</div>

						<div class="form-group">
							<label for="editPassword">
								<i class="fas fa-lock mr-1"></i> Пароль <small class="text-muted">(оставьте пустым, если не нужно менять)</small>
							</label>
							<input type="password" class="form-control" id="editPassword" name="password">
						</div>
						<div class="modal-footer">
							<button type="button" class="btn btn-secondary" data-dismiss="modal">
								<i class="fas fa-times mr-1"></i> Отмена
							</button>
							<button type="submit" class="btn btn-primary">
								<i class="fas fa-save mr-1"></i> Сохранить изменения
							</button>
						</div>
					</form>
				</div>
			</div>
		</div>
	</div>

    
    <div class="modal fade" id="userServicesModal" tabindex="-1" role="dialog" aria-labelledby="userServicesModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="userServicesModalLabel"><i class="fas fa-tasks mr-2"></i>Управление услугами пользователя</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body">
                    <input type="hidden" id="userIdField" value="">
                    
                    
                    <ul class="nav nav-pills mb-3" id="servicesTab" role="tablist">
                        <li class="nav-item">
                            <a class="nav-link active" id="assigned-services-tab" data-toggle="pill" href="#assigned-services" role="tab">
                                <i class="fas fa-project-diagram mr-1"></i> Назначенные услуги
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" id="available-services-tab" data-toggle="pill" href="#available-services" role="tab">
                                <i class="fas fa-plus-circle mr-1"></i> Услуги
                            </a>
                        </li>
                    </ul>
                    
                    
                    <div class="tab-content" id="servicesTabContent">
                        
                        <div class="tab-pane fade show active" id="assigned-services" role="tabpanel">
                            <div class="form-group">
                                <div class="input-group mb-3">
                                    <div class="input-group-prepend">
                                        <span class="input-group-text"><i class="fas fa-search"></i></span>
                                    </div>
                                    <input type="text" class="form-control" id="searchAssignedServices" placeholder="Поиск назначенных услуг...">
                                </div>
                            </div>
                            
                            <div class="services-list">
                                <div id="userServicesList">
                                    
                                    <div class="text-center p-4" id="loadingServices">
                                        <i class="fas fa-spinner fa-spin fa-2x mb-3"></i>
                                        <p>Загрузка услуг...</p>
                                    </div>
                                    <div class="text-center p-4" id="noAssignedServices" style="display: none;">
                                        <i class="fas fa-info-circle fa-2x mb-3"></i>
                                        <p>Пользователю не назначено ни одной услуги</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        
                        <div class="tab-pane fade" id="available-services" role="tabpanel">
                            <div class="form-group">
                                <div class="input-group mb-3">
                                    <div class="input-group-prepend">
                                        <span class="input-group-text"><i class="fas fa-search"></i></span>
                                    </div>
                                    <input type="text" class="form-control" id="searchAvailableServices" placeholder="Поиск доступных услуг...">
                                </div>
                            </div>
                            
                            <div class="available-services-grid mb-3">
                                <div id="availableServicesList">
                                    
                                    <div class="text-center p-4" id="loadingAvailableServices">
                                        <i class="fas fa-spinner fa-spin fa-2x mb-3"></i>
                                        <p>Загрузка доступных услуг...</p>
                                    </div>
                                    <div class="text-center p-4" id="noAvailableServices" style="display: none;">
                                        <i class="fas fa-exclamation-circle fa-2x mb-3"></i>
                                        <p>Нет доступных услуг для назначения</p>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="text-right">
                                <button type="button" class="btn btn-secondary" data-dismiss="modal">
                                    <i class="fas fa-times mr-1"></i> Отмена
                                </button>
                                <button type="button" class="btn btn-primary" id="assignSelectedServices">
                                    <i class="fas fa-check mr-1"></i> Назначить выбранные
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-dismiss="modal">
                        <i class="fas fa-times mr-1"></i> Закрыть
                    </button>
                </div>
            </div>
        </div>
    </div>
	
    <div class="modal fade" id="addServiceModal" tabindex="-1" role="dialog" aria-labelledby="addServiceModalLabel" aria-hidden="true">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="addServiceModalLabel"><i class="fas fa-plus-circle mr-2"></i>Добавить новую услугу</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body">
                    <form id="addServiceForm" action="{{ url_for('secondary_admin.add_service') }}" method="POST">
                        <div class="form-group">
                            <label for="serviceName">
                                <i class="fas fa-concierge-bell mr-1"></i> Название услуги
                            </label>
                            <input type="text" class="form-control" id="serviceName" name="name" placeholder="Введите название услуги" required>
                        </div>
                        <div class="form-group">
                            <label for="startNumber">
                                <i class="fas fa-sort-numeric-down mr-1"></i> Начальный номер
                            </label>
                            <input type="number" class="form-control" id="startNumber" name="start_number" required>
                        </div>
                        <div class="form-group">
                            <label for="endNumber">
                                <i class="fas fa-sort-numeric-up mr-1"></i> Конечный номер
                            </label>
                            <input type="number" class="form-control" id="endNumber" name="end_number" required>
                        </div>
                        <div class="form-group">
                        </div>
                        <div class="modal-footer">
                            <button type="button" class="btn btn-secondary" data-dismiss="modal">
                                <i class="fas fa-times mr-1"></i> Отмена
                            </button>
                            <button type="submit" class="btn btn-primary">
                                <i class="fas fa-save mr-1"></i> Добавить услугу
                            </button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>

    
    <div class="modal fade" id="editServiceModal" tabindex="-1" role="dialog" aria-labelledby="editServiceModalLabel" aria-hidden="true">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="editServiceModalLabel"><i class="fas fa-edit mr-2"></i>Редактировать услугу</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body">
                    <form id="editServiceForm">
                        <input type="hidden" id="editServiceId" name="service_id">
                        <div class="form-group">
                            <label for="editServiceName">
                                <i class="fas fa-concierge-bell mr-1"></i> Название услуги
                            </label>
                            <input type="text" class="form-control" id="editServiceName" name="name" required>
                        </div>
                        <div class="form-group">
                            <label for="editStartNumber">
                                <i class="fas fa-sort-numeric-down mr-1"></i> Начальный номер
                            </label>
                            <input type="number" class="form-control" id="editStartNumber" name="start_number" required>
                        </div>
                        <div class="form-group">
                            <label for="editEndNumber">
                                <i class="fas fa-sort-numeric-up mr-1"></i> Конечный номер
                            </label>
                            <input type="number" class="form-control" id="editEndNumber" name="end_number" required>
                        </div>
                        <div class="form-group">
                            <label for="editCabinetNumber">
                                <i class="fas fa-door-open mr-1"></i> Номер кабинета
                            </label>
                            <input type="text" class="form-control" id="editCabinetNumber" name="cabinet">
                        </div>
                        <div class="modal-footer">
                            <button type="button" class="btn btn-secondary" data-dismiss="modal">
                                <i class="fas fa-times mr-1"></i> Отмена
                            </button>
                            <button type="submit" class="btn btn-primary">
                                <i class="fas fa-save mr-1"></i> Сохранить изменения
                            </button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>

    
    <div class="modal fade" id="licenseModal" tabindex="-1" role="dialog" aria-labelledby="licenseModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="licenseModalLabel"><i class="fas fa-file-contract mr-2"></i>Лицензионное соглашение</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body">
                    <div class="license-content">
                        <div class="text-center mb-4">
                            <i class="fas fa-file-alt fa-3x text-secondary mb-3"></i>
                            <h4>Добро пожаловать!</h4>
                            <p class="text-muted">Прежде чем продолжить использование нашего программного обеспечения, пожалуйста, ознакомьтесь с условиями лицензионного соглашения:</p>
                        </div>
                        
                        <div class="license-item mb-3">
                            <h5><i class="fas fa-check-circle mr-2 text-secondary"></i>Пункт 1</h5>
                            <p>Вы соглашаетесь использовать данное программное обеспечение только в законных целях и в соответствии с условиями данного соглашения.</p>
                        </div>
                        
                        <div class="license-item mb-3">
                            <h5><i class="fas fa-check-circle mr-2 text-secondary"></i>Пункт 2</h5>
                            <p>Вы не имеете права копировать, изменять, распространять или иным образом использовать программное обеспечение без предварительного письменного разрешения правообладателя.</p>
                        </div>
                        
                        <div class="license-item mb-3">
                            <h5><i class="fas fa-check-circle mr-2 text-secondary"></i>Пункт 3</h5>
                            <p>Программное обеспечение предоставляется "как есть", без каких-либо гарантий, явных или подразумеваемых.</p>
                        </div>
                        
                        <div class="license-item mb-3">
                            <h5><i class="fas fa-check-circle mr-2 text-secondary"></i>Пункт 4</h5>
                            <p>Правообладатель не несет ответственности за любые убытки, возникшие в результате использования или невозможности использования программного обеспечения.</p>
                        </div>
                        
                        <div class="license-item mb-3">
                            <h5><i class="fas fa-check-circle mr-2 text-secondary"></i>Пункт 5</h5>
                            <p>Вы обязуетесь не использовать программное обеспечение для осуществления любых действий, нарушающих законы или права третьих лиц.</p>
                        </div>
                        
                        <div class="license-item mb-3">
                            <h5><i class="fas fa-check-circle mr-2 text-secondary"></i>Пункт 6</h5>
                            <p>Вы соглашаетесь не пытаться обойти, деактивировать или иным образом вмешиваться в функции безопасности программного обеспечения.</p>
                        </div>
                        
                        <div class="license-item mb-3">
                            <h5><i class="fas fa-check-circle mr-2 text-secondary"></i>Пункт 7</h5>
                            <p>В случае нарушения вами условий данного соглашения, правообладатель имеет право расторгнуть соглашение без предварительного уведомления.</p>
                        </div>
                        
                        <div class="alert alert-info mt-4">
                            <i class="fas fa-info-circle mr-2"></i>
                            Продолжая использовать данное программное обеспечение, вы подтверждаете, что прочли и поняли данное соглашение, и согласны с его условиями.
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-success" id="acceptLicense">
                        <i class="fas fa-check-circle mr-1"></i> Принять
                    </button>
                    <button type="button" class="btn btn-danger" id="declineLicense">
                        <i class="fas fa-times-circle mr-1"></i> Выход
                    </button>
                </div>
            </div>
        </div>
    </div>
    
	
	<div class="modal fade" id="scheduleServiceModal" tabindex="-1" role="dialog" aria-labelledby="scheduleServiceModalLabel" aria-hidden="true">
		<div class="modal-dialog modal-lg" role="document">
			<div class="modal-content">
				<div class="modal-header">
					<h5 class="modal-title" id="scheduleServiceModalLabel"><i class="fas fa-calendar-alt mr-2"></i>Редактирование расписания</h5>
					<button type="button" class="close" data-dismiss="modal" aria-label="Close">
						<span aria-hidden="true">&times;</span>
					</button>
				</div>
				<div class="modal-body">
					<form id="scheduleForm">
						
						<input type="hidden" id="currentServiceIdField" value="">
						
						<div class="form-group">
							<label for="planName">
								<i class="fas fa-bookmark mr-1"></i> Наименование услуги
							</label>
							<input type="text" class="form-control" id="planName" disabled>
						</div>
						
						<div class="schedule-container">
							<h5 class="mb-3"><i class="fas fa-clock mr-2"></i>Расписание работы</h5>
							
							<div class="table-responsive">
								<table class="table table-bordered table-sm">
									<thead class="thead-light">
										<tr>
											<th class="text-center" style="width: 40%">День недели</th>
											<th class="text-center" style="width: 25%">Начало</th>
											<th class="text-center" style="width: 25%">Конец</th>
											<th class="text-center" style="width: 10%">Активен</th>
										</tr>
									</thead>
									<tbody>
										<tr>
											<td>
												<label for="monday" class="mb-0">
													<i class="fas fa-calendar-day mr-1"></i> Понедельник
												</label>
											</td>
											<td>
												<input type="time" class="form-control form-control-sm" id="monday_start">
											</td>
											<td>
												<input type="time" class="form-control form-control-sm" id="monday_end">
											</td>
											<td class="text-center">
												<div class="custom-control custom-switch">
													<input type="checkbox" class="custom-control-input" id="monday" value="1">
													<label class="custom-control-label" for="monday"></label>
												</div>
											</td>
										</tr>
										<tr>
											<td>
												<label for="tuesday" class="mb-0">
													<i class="fas fa-calendar-day mr-1"></i> Вторник
												</label>
											</td>
											<td>
												<input type="time" class="form-control form-control-sm" id="tuesday_start">
											</td>
											<td>
												<input type="time" class="form-control form-control-sm" id="tuesday_end">
											</td>
											<td class="text-center">
												<div class="custom-control custom-switch">
													<input type="checkbox" class="custom-control-input" id="tuesday" value="2">
													<label class="custom-control-label" for="tuesday"></label>
												</div>
											</td>
										</tr>
										<tr>
											<td>
												<label for="wednesday" class="mb-0">
													<i class="fas fa-calendar-day mr-1"></i> Среда
												</label>
											</td>
											<td>
												<input type="time" class="form-control form-control-sm" id="wednesday_start">
											</td>
											<td>
												<input type="time" class="form-control form-control-sm" id="wednesday_end">
											</td>
											<td class="text-center">
												<div class="custom-control custom-switch">
													<input type="checkbox" class="custom-control-input" id="wednesday" value="3">
													<label class="custom-control-label" for="wednesday"></label>
												</div>
											</td>
										</tr>
										<tr>
											<td>
												<label for="thursday" class="mb-0">
													<i class="fas fa-calendar-day mr-1"></i> Четверг
												</label>
											</td>
											<td>
												<input type="time" class="form-control form-control-sm" id="thursday_start">
											</td>
											<td>
												<input type="time" class="form-control form-control-sm" id="thursday_end">
											</td>
											<td class="text-center">
												<div class="custom-control custom-switch">
													<input type="checkbox" class="custom-control-input" id="thursday" value="4">
													<label class="custom-control-label" for="thursday"></label>
												</div>
											</td>
										</tr>
										<tr>
											<td>
												<label for="friday" class="mb-0">
													<i class="fas fa-calendar-day mr-1"></i> Пятница
												</label>
											</td>
											<td>
												<input type="time" class="form-control form-control-sm" id="friday_start">
											</td>
											<td>
												<input type="time" class="form-control form-control-sm" id="friday_end">
											</td>
											<td class="text-center">
												<div class="custom-control custom-switch">
													<input type="checkbox" class="custom-control-input" id="friday" value="5">
													<label class="custom-control-label" for="friday"></label>
												</div>
											</td>
										</tr>
										<tr>
											<td>
												<label for="saturday" class="mb-0">
													<i class="fas fa-calendar-day mr-1"></i> Суббота
												</label>
											</td>
											<td>
												<input type="time" class="form-control form-control-sm" id="saturday_start">
											</td>
											<td>
												<input type="time" class="form-control form-control-sm" id="saturday_end">
											</td>
											<td class="text-center">
												<div class="custom-control custom-switch">
													<input type="checkbox" class="custom-control-input" id="saturday" value="6">
													<label class="custom-control-label" for="saturday"></label>
												</div>
											</td>
										</tr>
										<tr>
											<td>
												<label for="sunday" class="mb-0">
													<i class="fas fa-calendar-day mr-1"></i> Воскресенье
												</label>
											</td>
											<td>
												<input type="time" class="form-control form-control-sm" id="sunday_start">
											</td>
											<td>
												<input type="time" class="form-control form-control-sm" id="sunday_end">
											</td>
											<td class="text-center">
												<div class="custom-control custom-switch">
													<input type="checkbox" class="custom-control-input" id="sunday" value="7">
													<label class="custom-control-label" for="sunday"></label>
												</div>
											</td>
										</tr>
									</tbody>
								</table>
							</div>
							
							<div class="mt-3 p-3 bg-light rounded">
								<div class="d-flex align-items-center">
									<i class="fas fa-info-circle text-primary mr-2"></i>
									<small class="text-muted">Установите галочку для активации дня недели и укажите время работы. Время должно быть в формате ЧЧ:ММ.</small>
								</div>
								
								<div class="mt-2">
									<button type="button" class="btn btn-sm btn-outline-secondary" id="copyToAllBtn">
										<i class="fas fa-copy mr-1"></i> Копировать время понедельника на все дни
									</button>
									<button type="button" class="btn btn-sm btn-outline-secondary ml-2" id="workdaysOnlyBtn">
										<i class="fas fa-briefcase mr-1"></i> Активировать только рабочие дни
									</button>
								</div>
							</div>
						</div>
					</form>
				</div>
				<div class="modal-footer">
					<button type="button" class="btn btn-secondary" data-dismiss="modal">
						<i class="fas fa-times mr-1"></i> Отмена
					</button>
					<button type="button" class="btn btn-primary" id="saveScheduleBtn">
						<i class="fas fa-save mr-1"></i> Сохранить
					</button>
				</div>
			</div>
		</div>
	</div>



<div id="notification-container" style="position: fixed; top: 20px; right: 20px; z-index: 9999;"></div>


<template id="folder-card-template">
    
</template>
<template id="video-card-template">
    
</template>

<script>
if (!window.adminScriptLoaded) {
    window.adminScriptLoaded = true;
    
    document.addEventListener('DOMContentLoaded', function() {
        function showNotification(message, type = 'success') {
            const container = $('#notification-container');
            const icon = { success: 'fa-check-circle', error: 'fa-times-circle', warning: 'fa-exclamation-triangle', info: 'fa-info-circle' }[type];
            const alertClass = { success: 'alert-success', error: 'alert-danger', warning: 'alert-warning', info: 'alert-info' }[type];
            const notification = $(`<div class="alert ${alertClass} alert-dismissible fade show" role="alert" style="min-width: 300px;"><i class="fas ${icon} mr-2"></i>${message}<button type="button" class="close" data-dismiss="alert">×</button></div>`);
            container.append(notification);
            setTimeout(() => notification.fadeOut(500, () => notification.remove()), 5000);
        }
        $(document).on('click', '.delete-user-btn', function() {
            if (confirm('Вы уверены, что хотите удалить этого пользователя?')) {
                $(this).closest('.user-row').fadeOut(500, function() { $(this).remove(); });
                showNotification('Пользователь успешно удален', 'success');
            }
        });
        $(document).on('click', '.edit-user-btn', function() {
            const button = $(this);
            $('#editUserId').val(button.data('id'));
            $('#editUsername').val(button.data('username'));
            $('#editRole').val(button.data('role')).trigger('change');
            $('#editCabinet').val(button.data('cabinet'));
            if (button.data('role') === 'tablo') {
                $('#videoSettingsContainer').show();
                const showVideo = button.data('video') === true || button.data('video') === 'True' || button.data('video') === 'true';
                $('#editShowVideo').prop('checked', showVideo);
                if(showVideo) {
                    $('#videoFolderContainer').show();
                    $('#editVideoFolder').html('<option value="">Загрузка...</option>');
                    setTimeout(() => {
                        const folders = '<option value="">- Не выбрано -</option><option value="promo">promo</option><option value="education">education</option>';
                        $('#editVideoFolder').html(folders).val(button.data('video-folder'));
                    }, 500);
                } else {
                    $('#videoFolderContainer').hide();
                }
            } else {
                $('#videoSettingsContainer').hide();
            }
        });
        $('#editRole, #editShowVideo').on('change', function(){
            const isTablo = $('#editRole').val() === 'tablo';
            const isChecked = $('#editShowVideo').is(':checked');
            if(isTablo) {
                $('#videoSettingsContainer').show();
                if(isChecked) $('#videoFolderContainer').show();
                else $('#videoFolderContainer').hide();
            } else {
                $('#videoSettingsContainer').hide();
            }
        });
        $('#saveUserChangesBtn').on('click', function() {
            showNotification('Изменения успешно сохранены!', 'success');
            $('#editUserModal').modal('hide');
        });
        $(document).on('click', '.toggle-group', function() {
            const groupId = $(this).data('group-id');
            $(`.group-${groupId}`).toggle();
            $(this).find('i').toggleClass('fa-plus fa-minus');
        });
        $(document).on('click', '.delete-service-btn', function() {
            if (confirm('Вы уверены, что хотите удалить эту услугу?')) {
                $(this).closest('.service-row').fadeOut(500, function() { $(this).remove(); });
                showNotification('Услуга успешно удалена', 'success');
            }
        });
        
        $(document).on('click', '.delete-all-tickets-btn', function() {
            if (confirm('Вы уверены, что хотите удалить ВСЕ талоны для этой услуги?')) {
                 showNotification('Все талоны для услуги удалены', 'warning');
            }
        });
        const fileSystem = {
            '/': {
                folders: [{ name: 'promo', files: 1, size: '150 МБ' }, { name: 'education', files: 2, size: '320 МБ' }],
                videos: [{ name: 'intro.mp4', size: '25 МБ', duration: '00:30' }, { name: 'background.mp4', size: '80 МБ', duration: '05:12' }]
            },
            '/promo/': {
                folders: [],
                videos: [{ name: 'advert_new.mp4', size: '150 МБ', duration: '01:15' }]
            },
            '/education/': {
                folders: [{ name: 'internal', files: 1, size: '120 МБ' }],
                videos: [{ name: 'howto_wash_hands.mp4', size: '200 МБ', duration: '02:45' }]
            },
            '/education/internal/': {
                folders: [],
                videos: [{ name: 'doctor_speech.mp4', size: '120 МБ', duration: '08:20' }]
            }
        };

        function renderFileSystem(path) {
            const foldersContainer = $('#folders-container').empty();
            const videosContainer = $('#videos-container').empty();
            const breadcrumb = $('#breadcrumb-container').empty();
            
            const content = fileSystem[path] || fileSystem['/'];
            let currentPath = '';
            const pathParts = path.split('/').filter(p => p);
            breadcrumb.append(`<li class="breadcrumb-item"><a href="#" class="folder-link" data-path="/">Корень</a></li>`);
            pathParts.forEach(part => {
                currentPath += `/${part}`;
                breadcrumb.append(`<li class="breadcrumb-item"><a href="#" class="folder-link" data-path="${currentPath}/">${part}</a></li>`);
            });
            if (content.folders.length) {
                content.folders.forEach(folder => {
                    const card = $(`<div class="col-md-3 mb-4 folder-card">
                        <div class="card bg-dark text-light folder-item" data-path="${path}${folder.name}/" data-name="${folder.name}">
                            <div class="card-body p-3">
                                <i class="fas fa-folder fa-2x text-warning"></i>
                                <h6 class="card-title text-truncate mt-2">${folder.name}</h6>
                                <p class="card-text small text-muted">${folder.files} видео, ${folder.size}</p>
                            </div>
                            <div class="card-footer p-2 text-center"><button class="btn btn-primary btn-sm open-folder">Открыть</button></div>
                        </div></div>`);
                    foldersContainer.append(card);
                });
            } else {
                foldersContainer.html('<div class="col-12 text-center text-muted"><p>Нет папок</p></div>');
            }
            if (content.videos.length) {
                content.videos.forEach(video => {
                    const card = $(`<div class="col-md-3 mb-4 video-card">
                        <div class="card bg-dark text-light video-item" data-path="${path}${video.name}" data-name="${video.name}">
                           <div class="video-thumbnail position-relative d-flex align-items-center justify-content-center" style="height: 140px; background-color: #111;">
                                <i class="fas fa-play-circle fa-3x text-light opacity-75"></i>
                                <span class="position-absolute badge badge-dark" style="bottom: 5px; right: 5px;">${video.duration}</span>
                           </div>
                           <div class="card-body p-3">
                                <h6 class="card-title text-truncate">${video.name}</h6>
                                <p class="card-text small text-muted">${video.size}</p>
                           </div>
                           <div class="card-footer p-2 text-center">
                                <button class="btn btn-info btn-sm preview-video-btn"><i class="fas fa-play"></i> Просмотр</button>
                                <button class="btn btn-danger btn-sm delete-video-btn ml-2"><i class="fas fa-trash"></i></button>
                           </div>
                        </div></div>`);
                    videosContainer.append(card);
                });
            } else {
                videosContainer.html('<div class="col-12 text-center text-muted"><p>Нет видео</p></div>');
            }
        }
        $(document).on('click', '.folder-link, .open-folder', function(e) {
            e.preventDefault();
            const path = $(this).data('path') || $(this).closest('.folder-item').data('path');
            renderFileSystem(path);
        });
        $(document).on('click', '.delete-video-btn, .delete-folder-btn', function(e) {
            e.preventDefault();
             if (confirm('Вы уверены, что хотите удалить этот элемент?')) {
                $(this).closest('.video-card, .folder-card').fadeOut(500, function() { $(this).remove(); });
                showNotification('Элемент удален', 'success');
            }
        });
        $('a[data-toggle="pill"][href="#videos"]').on('shown.bs.tab', function() {
            renderFileSystem('/');
        });

    });
}
</script>